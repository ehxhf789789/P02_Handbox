{
  "id": "cnt-integrated-workflow-v2",
  "name": "CNT 통합 평가 시스템 v2.0",
  "description": "건설신기술 인증 신청서 평가를 위한 LLM 기반 심사위원회 시뮬레이션 - 매칭 비율 기반 동적 프로파일 + Citation 추적 + 7/10 다수결",
  "category": "건설신기술",
  "version": "2.0.0",
  "nodes": [
    {
      "id": "static_kb_manual",
      "type": "local-file",
      "position": { "x": 0, "y": 30 },
      "data": {
        "label": "CNT 심사 매뉴얼",
        "color": "#ef4444",
        "description": "건설신기술 심사 매뉴얼 PDF",
        "config": {
          "file_filter": "*.pdf;*.hwp",
          "expected_content": ["심사 절차", "평가 항목", "신규성 기준", "진보성 기준"]
        }
      }
    },
    {
      "id": "static_kb_criteria",
      "type": "local-file",
      "position": { "x": 0, "y": 130 },
      "data": {
        "label": "세부 평가 기준",
        "color": "#ef4444",
        "description": "신규성/진보성 세부 배점 기준",
        "config": {
          "file_filter": "*.pdf;*.hwp;*.xlsx",
          "scoring_criteria": {
            "신규성": { "total": 50, "차별성": 25, "독창성_자립성": 25 },
            "진보성": { "total": 50, "품질향상": 15, "개발정도": 15, "안전성": 10, "첨단기술성": 10 }
          }
        }
      }
    },
    {
      "id": "static_kb_merge",
      "type": "merge",
      "position": { "x": 200, "y": 80 },
      "data": {
        "label": "정적 KB 통합",
        "color": "#8b5cf6",
        "description": "매뉴얼 + 평가기준 병합",
        "config": { "merge_strategy": "concatenate" }
      }
    },
    {
      "id": "static_kb_splitter",
      "type": "text-splitter",
      "position": { "x": 380, "y": 80 },
      "data": {
        "label": "텍스트 청킹",
        "color": "#c084fc",
        "description": "1500 tokens, 300 overlap",
        "config": { "chunk_size": 1500, "chunk_overlap": 300 }
      }
    },
    {
      "id": "static_kb_embedder",
      "type": "embedder",
      "position": { "x": 560, "y": 80 },
      "data": {
        "label": "임베딩",
        "color": "#d8b4fe",
        "description": "Titan Embed v2",
        "config": { "model": "amazon.titan-embed-text-v2:0" }
      }
    },
    {
      "id": "static_kb_store",
      "type": "vector-opensearch",
      "position": { "x": 740, "y": 80 },
      "data": {
        "label": "정적 지식베이스",
        "color": "#ff9900",
        "description": "Static KB (OpenSearch)",
        "config": { "index_name": "cnt_static_kb", "persist": true }
      }
    },
    {
      "id": "dynamic_kb_kisti_articles",
      "type": "kisti-articles",
      "position": { "x": 0, "y": 260 },
      "data": {
        "label": "KISTI 논문",
        "color": "#8b5cf6",
        "description": "학술논문 검색",
        "config": { "query": "건설신기술", "row_count": 20 }
      }
    },
    {
      "id": "dynamic_kb_kisti_patents",
      "type": "kisti-patents",
      "position": { "x": 0, "y": 340 },
      "data": {
        "label": "KISTI 특허",
        "color": "#a855f7",
        "description": "특허정보 검색",
        "config": { "query": "건설 기술", "row_count": 20 }
      }
    },
    {
      "id": "dynamic_kb_existing_cnt",
      "type": "local-file",
      "position": { "x": 0, "y": 420 },
      "data": {
        "label": "기지정 건설신기술",
        "color": "#f59e0b",
        "description": "기존 지정 CNT DB",
        "config": { "file_filter": "*.xlsx;*.csv" }
      }
    },
    {
      "id": "dynamic_kb_merge",
      "type": "merge",
      "position": { "x": 200, "y": 340 },
      "data": {
        "label": "외부 데이터 통합",
        "color": "#8b5cf6",
        "description": "API 결과 병합",
        "config": { "merge_strategy": "union", "deduplication": true }
      }
    },
    {
      "id": "dynamic_kb_store",
      "type": "vector-opensearch",
      "position": { "x": 740, "y": 340 },
      "data": {
        "label": "동적 지식베이스",
        "color": "#ff9900",
        "description": "Dynamic KB (OpenSearch)",
        "config": { "index_name": "cnt_dynamic_kb", "persist": true }
      }
    },
    {
      "id": "kb_query",
      "type": "rag-retriever",
      "position": { "x": 920, "y": 200 },
      "data": {
        "label": "RAG 검색",
        "color": "#a855f7",
        "description": "정적+동적 KB 검색",
        "config": { "top_k": 10, "similarity_threshold": 0.7, "rerank": true }
      }
    },
    {
      "id": "cnt_folder_input",
      "type": "local-folder",
      "position": { "x": 1100, "y": 30 },
      "data": {
        "label": "CNT 신청서 폴더",
        "color": "#ef4444",
        "description": "신청서 폴더 (10개 유형 문서)",
        "config": {
          "file_filter": "*.pdf;*.hwp;*.docx;*.xlsx",
          "document_types": ["기술개요서", "기술설명서", "시험성적서", "인증서류", "도면", "사진자료", "시공사례", "비교분석표", "원가분석", "홍보용책자"]
        }
      }
    },
    {
      "id": "cnt_doc_aggregator",
      "type": "merge",
      "position": { "x": 1280, "y": 30 },
      "data": {
        "label": "문서 통합",
        "color": "#f97316",
        "description": "10개 유형 문서 통합",
        "config": { "aggregation_mode": "by_document_type" }
      }
    },
    {
      "id": "proposal_parser",
      "type": "doc-pdf-parser",
      "position": { "x": 1400, "y": 30 },
      "data": {
        "label": "문서 파싱",
        "color": "#ef4444",
        "description": "신청서 텍스트 추출",
        "config": { "extract_tables": true, "ocr_enabled": true }
      }
    },
    {
      "id": "booklet_page1_parser",
      "type": "doc-pdf-parser",
      "position": { "x": 1280, "y": 130 },
      "data": {
        "label": "홍보책자 분야 추출",
        "color": "#f59e0b",
        "description": "홍보용 책자 1페이지 지정 분야 추출",
        "config": {
          "source": "cnt_folder_input",
          "file_pattern": "*홍보*책자*;*booklet*",
          "page_range": "1",
          "extract_region": {
            "description": "1페이지 좌측 상단 지정 분야 영역",
            "method": "text_pattern",
            "pattern": "지정\\s*분야[:\\s]*(.+?)(?:\\n|$)",
            "fallback_region": { "x_range": [0, 0.5], "y_range": [0, 0.3] }
          },
          "output_format": { "raw_text": "추출된 원본 텍스트", "parsed": { "major": "대분류", "mid": "중분류", "minor": "소분류" } }
        }
      }
    },
    {
      "id": "domain_classifier",
      "type": "custom-agent",
      "position": { "x": 1400, "y": 130 },
      "data": {
        "label": "기술분야 분류",
        "color": "#f59e0b",
        "description": "지정 분야 → 표준 분류체계 매핑",
        "config": {
          "agent_type": "domain_classifier",
          "model": "claude-3-haiku",
          "temperature": 0.1,
          "max_tokens": 1024,
          "taxonomy": {
            "토목": {
              "구조/콘크리트": ["내구성", "균열보수", "프리캐스트", "교량", "터널라이닝"],
              "지반/기초": ["연약지반", "말뚝", "앵커", "사면안정", "지하수"],
              "수리/환경": ["상하수도", "수처리", "하천", "해안", "환경복원"],
              "도로/포장": ["아스팔트", "콘크리트포장", "교통시설", "도로안전"],
              "안전/품질관리": ["계측", "모니터링", "비파괴검사", "품질시험"]
            },
            "건축": {
              "건축구조": ["철근콘크리트", "철골", "내진", "면진", "모듈러"],
              "건축시공/재료": ["마감재", "단열", "방수", "거푸집", "3D프린팅"],
              "건축환경/설비": ["공조", "급배수", "소방", "에너지", "스마트빌딩"]
            },
            "기계설비": {
              "기계/에너지": ["펌프", "배관", "냉난방", "신재생에너지"],
              "전기/통신": ["수배전", "조명", "통신", "IoT"]
            }
          },
          "system_prompt": "건설신기술 신청서의 지정 분야 텍스트를 표준 분류체계로 매핑합니다.\n\n입력: 지정 분야 텍스트 (예: '토목 > 콘크리트 > 내구성/균열보수')\n\n출력 형식:\n{\n  \"proposal_domain\": {\n    \"major\": \"대분류 (토목/건축/기계설비)\",\n    \"mid\": \"중분류\",\n    \"minor\": \"소분류\",\n    \"raw_text\": \"원본 텍스트\",\n    \"confidence\": 0.0-1.0\n  }\n}"
        }
      }
    },
    {
      "id": "match_ratio_assigner",
      "type": "custom-agent",
      "position": { "x": 1520, "y": 130 },
      "data": {
        "label": "매칭 비율 배정",
        "color": "#0284c7",
        "description": "매칭 비율에 따른 에이전트별 프로파일 자동 생성",
        "config": {
          "agent_type": "match_ratio_assigner",
          "model": "claude-3-haiku",
          "temperature": 0.1,
          "max_tokens": 4096,
          "match_ratio": {
            "exact_match": 2,
            "partial_match": 4,
            "no_match": 4,
            "note": "합계 = 10. 실험 조건별로 변경 가능"
          },
          "qualification_pool": [
            { "type": 1, "label": "관련 분야 대학 조교수급 이상의 교수" },
            { "type": 2, "label": "해당 분야 기술사 자격 취득 후 3년 이상 실무" },
            { "type": 3, "label": "관련 분야 박사학위 취득 후 3년 이상 연구/실무" },
            { "type": 4, "label": "관련 분야 10년 이상 연구/실무 경험" }
          ],
          "system_prompt": "매칭 비율(실험 변수)에 따라 10개 에이전트에 match_level을 배정하고, 각 레벨에 맞는 전문 분야를 신청서 분야와 taxonomy를 기반으로 자동 생성합니다.\n\n## 매칭 레벨 정의\n- exact_match: 신청서와 동일 분야 (대+중분류 일치)\n- partial_match: 동일 대분류, 다른 중분류\n- no_match: 다른 대분류\n\n## 출력 형식\n{\n  \"proposal_domain\": { \"major\": \"...\", \"mid\": \"...\", \"minor\": \"...\" },\n  \"match_ratio\": { \"exact\": 2, \"partial\": 4, \"no_match\": 4 },\n  \"agent_assignments\": [\n    {\n      \"agent_id\": \"evaluator_1\",\n      \"match_level\": \"exact_match\",\n      \"generated_domain\": { \"major\": \"토목\", \"mid\": \"구조/콘크리트\" },\n      \"qualification\": \"관련 분야 대학 조교수급 이상의 교수\",\n      \"reason\": \"신청서와 동일 분야\"\n    },\n    ...\n  ]\n}"
        }
      }
    },
    {
      "id": "evaluator_1",
      "type": "custom-agent",
      "position": { "x": 1700, "y": -180 },
      "data": {
        "label": "평가위원 #1",
        "color": "#6366f1",
        "description": "동적 프로파일 평가위원",
        "config": {
          "agent_id": "evaluator_1",
          "model": "claude-3-sonnet",
          "temperature": 0.5,
          "max_tokens": 8192,
          "dynamic_profile": true,
          "system_prompt": "당신은 건설기술 진흥법 제14조에 의거하여 위촉된 건설신기술 심사위원회 위원입니다.\n\n[자격 사항]\n- 전문 분야: {{generated_domain.major}} > {{generated_domain.mid}}\n- 자격 유형: {{qualification}}\n- 자격 근거: 건설기술 진흥법 시행령, KAIA 평가위원등록 기준\n\n[전문성 매칭: {{match_level}}]\n{{#if match_level == 'exact_match'}}\n본 신청기술의 지정 분야가 귀하의 전문 분야에 해당합니다.\n전문적 지식을 기반하여 기술 원리 수준에서의 비교 분석이 가능합니다.\n{{else if match_level == 'partial_match'}}\n본 신청기술은 귀하의 전문 분야와 동일 대분류에 속하는 관련 분야입니다.\n일반 공학 원리와 현장 적용성 관점에서 평가하십시오.\n{{else}}\n본 신청기술은 귀하의 전문 분야와 직접적 관련이 없는 분야입니다.\n제출된 증빙 자료의 형식적 완결성을 기준으로 평가하십시오.\n{{/if}}\n\n[평가 기준 – 건설신기술 심사·평가 규정 (국토교통부고시 제2024-268호)]\n\n① 신규성 (50점)\n  ⓐ 기존기술과의 차별성 (25점)\n     - 기존 기술/공법과 비교하여 새롭거나 크게 개선된 부분이 있는가\n     - 선행기술(특허, 논문, 기존 신기술) 대비 기술적 차별점이 명확한가\n  ⓑ 독창성과 자립성 (25점)\n     - 독자적으로 개발한 고유 기술인가\n     - 해외 기술 도입이 아닌 국내 자체 개발인가\n\n② 진보성 (50점)\n  ⓒ 품질 향상 (15점)\n     - 기존 기술 대비 품질이 향상되었음을 시험 데이터로 입증하는가\n  ⓓ 개발 정도 (15점)\n     - 실용화 수준에 도달하는가 (시공실적, 현장 검증)\n  ⓔ 안전성 (10점)\n     - 시공 및 사용 중 안전성이 확보되었는가\n  ⓕ 첨단기술성 (10점)\n     - 최신 기술 동향을 반영하고 있는가\n\n[개별 판정 규칙]\n- 신규성 합계 ≥ 35점 AND 진보성 합계 ≥ 35점 → \"Approved\"\n- 그 외 → \"Unapproved\"\n\n[근거 제시 규칙 – Citation]\n각 세부항목의 근거를 작성할 때, 반드시 다음을 포함하십시오:\n\n1. 신청서 인용: 신청서에서 해당 판단의 근거가 되는 부분을 명시\n   - 형식: [신청서: 문서명, 페이지/섹션]\n   - 예시: [신청서: 기술설명서, p.23 \"강도 시험 결과 기존 대비 35% 향상\"]\n\n2. 선행기술 인용: RAG 검색으로 제공된 선행기술과의 비교 시\n   - 형식: [선행기술: 출처ID]\n   - 예시: [선행기술: KIPRIS-2023-0012345 \"유사 공법이나 적용 조건이 다름\"]\n\n3. 매뉴얼 인용: 평가 기준 적용 근거\n   - 형식: [매뉴얼: 조항번호]\n   - 예시: [매뉴얼: 제8조제2항 \"신규성 인정 요건\"]\n\n근거가 불충분한 경우 \"신청서에서 관련 데이터를 확인할 수 없음\"으로 명시하십시오.\n\n[출력 형식]\n반드시 아래 JSON 형식으로만 응답하십시오. 다른 텍스트 없이 JSON만 출력합니다.\n\n{\n  \"evaluator_id\": \"evaluator_1\",\n  \"match_level\": \"exact_match | partial_match | no_match\",\n  \"generated_domain\": { \"major\": \"...\", \"mid\": \"...\" },\n  \"qualification\": \"자격 유형\",\n  \"proposal_domain\": { \"major\": \"...\", \"mid\": \"...\", \"minor\": \"...\" },\n  \n  \"novelty\": {\n    \"differentiation\": {\n      \"score\": 0-25,\n      \"rationale\": \"판단 근거 (200자 이내)\",\n      \"citations\": [\n        {\"type\": \"proposal\", \"ref\": \"문서명, p.XX\", \"quote\": \"핵심 인용 문구\"},\n        {\"type\": \"prior_art\", \"ref\": \"출처ID\", \"quote\": \"비교 내용\"},\n        {\"type\": \"manual\", \"ref\": \"조항번호\", \"quote\": \"관련 기준\"}\n      ]\n    },\n    \"originality\": {\n      \"score\": 0-25,\n      \"rationale\": \"판단 근거 (200자 이내)\",\n      \"citations\": []\n    },\n    \"subtotal\": 0-50\n  },\n  \n  \"progressiveness\": {\n    \"quality_improvement\": { \"score\": 0-15, \"rationale\": \"...\", \"citations\": [] },\n    \"development_level\": { \"score\": 0-15, \"rationale\": \"...\", \"citations\": [] },\n    \"safety\": { \"score\": 0-10, \"rationale\": \"...\", \"citations\": [] },\n    \"advanced_technology\": { \"score\": 0-10, \"rationale\": \"...\", \"citations\": [] },\n    \"subtotal\": 0-50\n  },\n  \n  \"total_score\": 0-100,\n  \n  \"individual_verdict\": {\n    \"decision\": \"Approved | Unapproved\",\n    \"novelty_pass\": true | false,\n    \"progress_pass\": true | false,\n    \"reasoning\": \"최종 판정 사유 (100자 이내)\"\n  }\n}"
        }
      }
    },
    {
      "id": "evaluator_2",
      "type": "custom-agent",
      "position": { "x": 1700, "y": -90 },
      "data": {
        "label": "평가위원 #2",
        "color": "#8b5cf6",
        "description": "동적 프로파일 평가위원",
        "config": {
          "agent_id": "evaluator_2",
          "model": "claude-3-sonnet",
          "temperature": 0.5,
          "max_tokens": 8192,
          "dynamic_profile": true,
          "inherit_prompt": "evaluator_1"
        }
      }
    },
    {
      "id": "evaluator_3",
      "type": "custom-agent",
      "position": { "x": 1700, "y": 0 },
      "data": {
        "label": "평가위원 #3",
        "color": "#a855f7",
        "description": "동적 프로파일 평가위원",
        "config": {
          "agent_id": "evaluator_3",
          "model": "claude-3-sonnet",
          "temperature": 0.5,
          "max_tokens": 8192,
          "dynamic_profile": true,
          "inherit_prompt": "evaluator_1"
        }
      }
    },
    {
      "id": "evaluator_4",
      "type": "custom-agent",
      "position": { "x": 1700, "y": 90 },
      "data": {
        "label": "평가위원 #4",
        "color": "#c084fc",
        "description": "동적 프로파일 평가위원",
        "config": {
          "agent_id": "evaluator_4",
          "model": "claude-3-sonnet",
          "temperature": 0.5,
          "max_tokens": 8192,
          "dynamic_profile": true,
          "inherit_prompt": "evaluator_1"
        }
      }
    },
    {
      "id": "evaluator_5",
      "type": "custom-agent",
      "position": { "x": 1700, "y": 180 },
      "data": {
        "label": "평가위원 #5",
        "color": "#d8b4fe",
        "description": "동적 프로파일 평가위원",
        "config": {
          "agent_id": "evaluator_5",
          "model": "claude-3-sonnet",
          "temperature": 0.5,
          "max_tokens": 8192,
          "dynamic_profile": true,
          "inherit_prompt": "evaluator_1"
        }
      }
    },
    {
      "id": "evaluator_6",
      "type": "custom-agent",
      "position": { "x": 1700, "y": 270 },
      "data": {
        "label": "평가위원 #6",
        "color": "#06b6d4",
        "description": "동적 프로파일 평가위원",
        "config": {
          "agent_id": "evaluator_6",
          "model": "claude-3-sonnet",
          "temperature": 0.5,
          "max_tokens": 8192,
          "dynamic_profile": true,
          "inherit_prompt": "evaluator_1"
        }
      }
    },
    {
      "id": "evaluator_7",
      "type": "custom-agent",
      "position": { "x": 1700, "y": 360 },
      "data": {
        "label": "평가위원 #7",
        "color": "#22c55e",
        "description": "동적 프로파일 평가위원",
        "config": {
          "agent_id": "evaluator_7",
          "model": "claude-3-sonnet",
          "temperature": 0.5,
          "max_tokens": 8192,
          "dynamic_profile": true,
          "inherit_prompt": "evaluator_1"
        }
      }
    },
    {
      "id": "evaluator_8",
      "type": "custom-agent",
      "position": { "x": 1700, "y": 450 },
      "data": {
        "label": "평가위원 #8",
        "color": "#eab308",
        "description": "동적 프로파일 평가위원",
        "config": {
          "agent_id": "evaluator_8",
          "model": "claude-3-sonnet",
          "temperature": 0.5,
          "max_tokens": 8192,
          "dynamic_profile": true,
          "inherit_prompt": "evaluator_1"
        }
      }
    },
    {
      "id": "evaluator_9",
      "type": "custom-agent",
      "position": { "x": 1700, "y": 540 },
      "data": {
        "label": "평가위원 #9",
        "color": "#f97316",
        "description": "동적 프로파일 평가위원",
        "config": {
          "agent_id": "evaluator_9",
          "model": "claude-3-sonnet",
          "temperature": 0.5,
          "max_tokens": 8192,
          "dynamic_profile": true,
          "inherit_prompt": "evaluator_1"
        }
      }
    },
    {
      "id": "evaluator_10",
      "type": "custom-agent",
      "position": { "x": 1700, "y": 630 },
      "data": {
        "label": "평가위원 #10",
        "color": "#ec4899",
        "description": "동적 프로파일 평가위원",
        "config": {
          "agent_id": "evaluator_10",
          "model": "claude-3-sonnet",
          "temperature": 0.5,
          "max_tokens": 8192,
          "dynamic_profile": true,
          "inherit_prompt": "evaluator_1"
        }
      }
    },
    {
      "id": "citation_extractor",
      "type": "custom-agent",
      "position": { "x": 1900, "y": 220 },
      "data": {
        "label": "Citation 추출",
        "color": "#a855f7",
        "description": "근거-원문 매핑 추출 및 검증",
        "config": {
          "agent_type": "citation_extractor",
          "model": "claude-3-haiku",
          "temperature": 0.1,
          "max_tokens": 4096,
          "system_prompt": "각 에이전트의 JSON 출력에서 citations 배열을 추출하여, 근거-원문 매핑 테이블을 구성하고 원문 대조(평가 검증)를 수행합니다.\n\n## 검증 항목\n1. proposal 인용: 신청서 원문에서 fuzzy matching으로 일치 확인\n2. prior_art 인용: RAG 검색 결과에 해당 출처ID가 존재하는지 확인\n3. manual 인용: 항상 verified=true\n\n## 출력 형식\n{\n  \"total_citations\": 총 citation 수,\n  \"verified_count\": 검증 통과 수,\n  \"unverified_count\": 검증 실패 수,\n  \"verification_rate\": 검증률 (0.0-1.0),\n  \"hallucination_suspects\": [검증 실패 citation 목록],\n  \"citation_by_type\": {\n    \"proposal\": { \"count\": N, \"verified\": M },\n    \"prior_art\": { \"count\": N, \"verified\": M },\n    \"manual\": { \"count\": N, \"verified\": M }\n  },\n  \"citation_by_match_level\": {\n    \"exact_match\": N,\n    \"partial_match\": N,\n    \"no_match\": N\n  },\n  \"full_map\": [상세 citation 목록]\n}"
        }
      }
    },
    {
      "id": "eval_merge",
      "type": "merge",
      "position": { "x": 2080, "y": 220 },
      "data": {
        "label": "평가 결과 수집",
        "color": "#ec4899",
        "description": "10개 에이전트 결과 + Citation 통합",
        "config": { "merge_strategy": "collect_all" }
      }
    },
    {
      "id": "voting_aggregator",
      "type": "custom-agent",
      "position": { "x": 2260, "y": 220 },
      "data": {
        "label": "투표 집계",
        "color": "#f97316",
        "description": "다수결 판정 (7/10 이상, ≥2/3)",
        "config": {
          "agent_type": "voting_aggregator",
          "model": "claude-3-sonnet",
          "temperature": 0.1,
          "max_tokens": 4096,
          "voting_rule": {
            "quorum": 10,
            "pass_threshold": 7,
            "method": "majority_two_thirds"
          },
          "system_prompt": "10명의 평가위원 독립 평가 결과를 집계합니다.\n\n## 집계 규칙 (건설기술 진흥법 시행령 근거)\n1. 각 위원의 개별 판정은 이미 결정되어 있음 (individual_verdict.decision)\n2. 최종 판정: 10명 중 7명 이상(≥2/3) \"Approved\" → 최종 Approved\n3. 10명 중 7명 미만 \"Approved\" → 최종 Unapproved\n\n## 추가 분석\n- 항목별 평균 점수 및 표준편차\n- 매칭도(exact/partial/no_match)별 평균 점수 비교\n- 불통과 투표 위원의 주요 감점 항목 분석\n\n## 출력 형식\n{\n  \"final_decision\": \"Approved | Unapproved\",\n  \"vote_count\": { \"approved\": N, \"unapproved\": M },\n  \"vote_threshold\": \"7/10 (2/3 이상)\",\n  \"threshold_met\": true | false,\n  \n  \"score_summary\": {\n    \"novelty\": { \"mean\": X, \"std\": X, \"min\": X, \"max\": X },\n    \"progressiveness\": { \"mean\": X, \"std\": X, \"min\": X, \"max\": X },\n    \"total\": { \"mean\": X, \"std\": X, \"min\": X, \"max\": X }\n  },\n  \n  \"by_match_level\": {\n    \"exact_match\": { \"count\": N, \"avg_score\": X, \"approved_ratio\": X },\n    \"partial_match\": { \"count\": N, \"avg_score\": X, \"approved_ratio\": X },\n    \"no_match\": { \"count\": N, \"avg_score\": X, \"approved_ratio\": X }\n  },\n  \n  \"by_sub_item\": {\n    \"differentiation\": { \"mean\": X, \"std\": X },\n    \"originality\": { \"mean\": X, \"std\": X },\n    \"quality_improvement\": { \"mean\": X, \"std\": X },\n    \"development_level\": { \"mean\": X, \"std\": X },\n    \"safety\": { \"mean\": X, \"std\": X },\n    \"advanced_technology\": { \"mean\": X, \"std\": X }\n  },\n  \n  \"dissenting_analysis\": [\n    {\n      \"evaluator_id\": \"evaluator_N\",\n      \"match_level\": \"...\",\n      \"decision\": \"Unapproved\",\n      \"primary_weakness\": \"감점 항목 및 사유\"\n    }\n  ],\n  \n  \"all_citations\": [모든 citation 목록]\n}"
        }
      }
    },
    {
      "id": "repeat_controller",
      "type": "loop",
      "position": { "x": 2080, "y": 380 },
      "data": {
        "label": "반복 실행 제어",
        "color": "#10b981",
        "description": "V2 일관성 검증용 N회 반복 평가",
        "config": {
          "repeat_count": 3,
          "scope": ["evaluator_1~10", "citation_extractor", "eval_merge", "voting_aggregator"],
          "fixed_per_round": ["match_ratio_assigner 출력 (매칭 배정은 1회만, 매 라운드 동일)"],
          "variable_per_round": ["temperature에 의한 LLM 응답 변동"],
          "output": { "rounds": "라운드별 결과 배열" }
        }
      }
    },
    {
      "id": "statistical_analyzer",
      "type": "custom-agent",
      "position": { "x": 2260, "y": 380 },
      "data": {
        "label": "통계 분석",
        "color": "#0284c7",
        "description": "ANOVA, ICC, Fleiss' Kappa 등",
        "config": {
          "agent_type": "statistical_analyzer",
          "model": "claude-3-sonnet",
          "temperature": 0.1,
          "max_tokens": 4096,
          "system_prompt": "반복 실행 결과를 통계적으로 분석합니다. LLM이 아닌 규칙 기반 계산으로 처리.\n\n## 분석 항목\n1. 라운드별 최종 판정 일치율\n2. 에이전트별 반복 점수 표준편차\n3. 세부항목별 반복 점수 변동\n4. 매칭도별 점수 비교 (One-way ANOVA)\n5. Fleiss' Kappa (위원 간 판정 일치도)\n6. ICC (반복 일관성)\n7. Citation 검증률 통계\n\n## 출력 형식\n{\n  \"decision_consistency\": \"N/N회 일치 (비율)\",\n  \"icc\": { \"value\": X, \"interpretation\": \"해석\" },\n  \"fleiss_kappa\": { \"value\": X, \"interpretation\": \"해석\" },\n  \"agent_stability\": [{ \"agent_id\": \"...\", \"match_level\": \"...\", \"score_std\": X }],\n  \"most_unstable_sub_item\": { \"name\": \"...\", \"std\": X },\n  \"anova_match_level\": { \"F_statistic\": X, \"p_value\": X, \"significant\": true|false },\n  \"match_level_consistency\": { \"exact\": { \"avg_std\": X }, \"partial\": {...}, \"no_match\": {...} },\n  \"citation_stats\": { \"avg_verification_rate\": X, \"by_match_level\": {...} }\n}"
        }
      }
    },
    {
      "id": "ground_truth",
      "type": "input",
      "position": { "x": 2440, "y": 30 },
      "data": {
        "label": "Ground Truth 라벨",
        "color": "#22c55e",
        "description": "입력 신청서는 모두 '통과' (실제 인증된 건설신기술)",
        "config": {
          "label_type": "passed",
          "expected_result": "Approved",
          "threshold": "7/10 (≥2/3)",
          "note": "기존 6/10에서 7/10으로 수정 (건설기술 진흥법 시행령 근거)"
        }
      }
    },
    {
      "id": "accuracy_validator",
      "type": "custom-agent",
      "position": { "x": 2620, "y": 60 },
      "data": {
        "label": "V1: 통과 판정률",
        "color": "#22c55e",
        "description": "규칙 기반 정확도 분석",
        "config": {
          "agent_type": "accuracy_validator",
          "model": "claude-3-haiku",
          "temperature": 0.1,
          "max_tokens": 2048,
          "metrics": {
            "pass_rate": "전체 평가 중 Approved 비율",
            "per_document_accuracy": "문서별 (N회 반복 중 Approved 비율)",
            "false_negative_analysis": {
              "method": "Unapproved 투표 위원의 세부항목 점수 → 가장 낮은 항목 식별",
              "by_match_level": "no_match 에이전트의 FN 비율이 높은지 분석"
            }
          },
          "system_prompt": "AI 판정 결과가 Ground Truth(실제 통과)와 일치하는지 검증합니다.\n\n## 검증 기준\n- 입력된 CNT 신청서는 모두 실제 심사위원회에서 '통과'된 건설신기술\n- AI 평가 결과도 '통과(Approved)'가 나와야 정확한 평가 (True Positive)\n- AI가 '불통과(Unapproved)'로 판정하면 오류 (False Negative)\n\n## 출력 형식\n{\n  \"overall_pass_rate\": \"N/M (비율)\",\n  \"per_document\": [{ \"doc_id\": \"...\", \"rounds_approved\": \"3/3\", \"weakest_sub_item\": \"...\" }],\n  \"false_negative_by_match_level\": {\n    \"exact\": { \"fn_rate\": X, \"common_weakness\": \"...\" },\n    \"partial\": { \"fn_rate\": X, \"common_weakness\": \"...\" },\n    \"no_match\": { \"fn_rate\": X, \"common_weakness\": \"...\" }\n  },\n  \"improvement_suggestions\": [\"개선 제안\"]\n}"
        }
      }
    },
    {
      "id": "consistency_checker",
      "type": "custom-agent",
      "position": { "x": 2620, "y": 160 },
      "data": {
        "label": "V2: 일관성 검증",
        "color": "#22c55e",
        "description": "반복 평가 일관성 분석",
        "config": {
          "agent_type": "consistency_checker",
          "model": "claude-3-haiku",
          "temperature": 0.1,
          "max_tokens": 2048,
          "system_prompt": "동일한 신청서에 대한 반복 평가 결과의 일관성을 분석합니다.\n\n## 입력: statistical_analyzer의 반복 실행 통계 결과\n\n## 분석 항목\n1. 최종 판정 일관성: N회 반복 중 동일 판정 비율\n2. ICC(2,1): 반복 측정 신뢰도 (>0.75 = good, >0.90 = excellent)\n3. Fleiss' Kappa: 위원 간 판정 일치도\n4. 에이전트별 점수 변동 폭: 표준편차 기준\n5. 가장 불안정한 세부항목: 표준편차가 가장 큰 항목\n6. 매칭도별 일관성 비교: exact_match 에이전트가 더 일관적인지\n\n## 출력 형식\n{\n  \"decision_consistency\": \"N/N회 일치 (비율)\",\n  \"icc\": { \"value\": X, \"interpretation\": \"해석\" },\n  \"fleiss_kappa\": { \"value\": X, \"interpretation\": \"해석\" },\n  \"agent_stability\": [{ \"agent_id\": \"...\", \"match_level\": \"...\", \"score_std\": X, \"rank\": N }],\n  \"most_unstable_sub_item\": { \"name\": \"...\", \"std\": X },\n  \"match_level_consistency\": {\n    \"exact\": { \"avg_std\": X },\n    \"partial\": { \"avg_std\": X },\n    \"no_match\": { \"avg_std\": X }\n  },\n  \"conclusion\": \"일관성 수준 종합 판단\"\n}"
        }
      }
    },
    {
      "id": "pattern_analyzer",
      "type": "custom-agent",
      "position": { "x": 2620, "y": 260 },
      "data": {
        "label": "V3: 패턴 분석",
        "color": "#22c55e",
        "description": "매칭도 효과 및 결정 요인 분석",
        "config": {
          "agent_type": "pattern_analyzer",
          "model": "claude-3-sonnet",
          "temperature": 0.2,
          "max_tokens": 4096,
          "system_prompt": "통과 문서의 세부항목 패턴 + 매칭도 효과를 분석합니다.\n\n## 분석 항목\n1. 세부항목별 점수 분포: 6개 항목 중 가장 높고 낮은 항목\n2. 분야별 패턴: 토목/건축/기계설비 분야별 점수 특성\n3. 매칭도-점수 상관관계: exact가 체계적으로 높거나 낮은지\n4. 결정적 항목: 통과/불통과 투표를 가르는 핵심 항목\n5. Citation 패턴: 매칭도별 citation 유형 빈도 차이\n\n## 출력 형식\n{\n  \"strong_items\": [{ \"item\": \"...\", \"avg\": X }],\n  \"weak_items\": [{ \"item\": \"...\", \"avg\": X }],\n  \"match_level_effect\": {\n    \"exact_vs_partial\": { \"score_diff\": X, \"p_value\": X, \"significant\": bool },\n    \"exact_vs_no_match\": { \"score_diff\": X, \"p_value\": X, \"significant\": bool },\n    \"partial_vs_no_match\": { \"score_diff\": X, \"p_value\": X, \"significant\": bool }\n  },\n  \"citation_pattern_by_match_level\": {\n    \"exact\": { \"proposal_ratio\": X, \"prior_art_ratio\": X, \"manual_ratio\": X },\n    \"partial\": {...},\n    \"no_match\": {...}\n  },\n  \"critical_factor\": \"통과/불통과를 가르는 핵심 변수\",\n  \"improvement_priorities\": [\"우선 개선 항목 순위\"]\n}"
        }
      }
    },
    {
      "id": "validation_merge",
      "type": "merge",
      "position": { "x": 2800, "y": 160 },
      "data": {
        "label": "검증 결과 통합",
        "color": "#22c55e",
        "description": "V1/V2/V3 + 통계 결과 병합",
        "config": { "merge_strategy": "consolidate" }
      }
    },
    {
      "id": "viz_dashboard",
      "type": "viz-chart",
      "position": { "x": 2980, "y": 60 },
      "data": {
        "label": "분석 대시보드",
        "color": "#06b6d4",
        "description": "8개 차트 종합 시각화",
        "config": {
          "charts": [
            { "id": "radar_sub_items", "type": "radar", "title": "세부항목별 평균 점수" },
            { "id": "boxplot_match_level", "type": "boxplot", "title": "매칭도별 총점 분포" },
            { "id": "heatmap_scores", "type": "heatmap", "title": "에이전트×세부항목 점수" },
            { "id": "bar_match_level", "type": "bar", "title": "매칭도별 평균 점수" },
            { "id": "pie_votes", "type": "pie", "title": "투표 분포" },
            { "id": "heatmap_citations", "type": "heatmap", "title": "매칭도×Citation 유형" },
            { "id": "line_consistency", "type": "line", "title": "라운드별 Approved 투표 수" },
            { "id": "violin_ratio_comparison", "type": "violin", "title": "실험 조건별 점수 분포" }
          ],
          "color_map": {
            "exact_match": "#22c55e",
            "partial_match": "#eab308",
            "no_match": "#ef4444"
          },
          "output_format": ["html", "png"]
        }
      }
    },
    {
      "id": "result_json",
      "type": "viz-json-viewer",
      "position": { "x": 2980, "y": 160 },
      "data": {
        "label": "결과 JSON",
        "color": "#22c55e",
        "description": "전체 결과 JSON 뷰어",
        "config": { "display_mode": "tree", "collapsible": true }
      }
    },
    {
      "id": "result_excel",
      "type": "export-excel",
      "position": { "x": 2980, "y": 260 },
      "data": {
        "label": "Excel 리포트",
        "color": "#22c55e",
        "description": "평가 결과 엑셀 저장",
        "config": {
          "output_path": "./output/cnt_evaluation_results_v2.xlsx",
          "sheets": ["Summary", "Evaluator_Scores", "By_Match_Level", "Citations", "Validation_Results"]
        }
      }
    },
    {
      "id": "result_pdf",
      "type": "export-pdf",
      "position": { "x": 2980, "y": 360 },
      "data": {
        "label": "PDF 보고서",
        "color": "#22c55e",
        "description": "최종 평가 보고서 PDF",
        "config": {
          "output_path": "./output/cnt_evaluation_report_v2.pdf",
          "title": "건설신기술 AI 평가 보고서 (매칭 비율 기반)",
          "sections": ["Executive Summary", "Match Level Analysis", "Evaluation Details", "Citations", "Validation Results", "Recommendations"]
        }
      }
    },
    {
      "id": "vote_chart",
      "type": "viz-vote-chart",
      "position": { "x": 2440, "y": 220 },
      "data": {
        "label": "투표 결과 차트",
        "color": "#f97316",
        "description": "통과/불통과 투표 분포 (7/10 기준선)",
        "config": { "chart_type": "pie", "show_threshold": true, "threshold_value": 7 }
      }
    },
    {
      "id": "citation_view",
      "type": "viz-citation",
      "position": { "x": 2440, "y": 320 },
      "data": {
        "label": "Citation 뷰어",
        "color": "#a855f7",
        "description": "평가 근거 목록 (검증 상태 포함)",
        "config": { "display_mode": "list", "group_by": "match_level", "show_verification_status": true }
      }
    }
  ],
  "edges": [
    { "id": "e1", "source": "static_kb_manual", "target": "static_kb_merge", "animated": true },
    { "id": "e2", "source": "static_kb_criteria", "target": "static_kb_merge", "animated": true },
    { "id": "e3", "source": "static_kb_merge", "target": "static_kb_splitter", "animated": true },
    { "id": "e4", "source": "static_kb_splitter", "target": "static_kb_embedder", "animated": true },
    { "id": "e5", "source": "static_kb_embedder", "target": "static_kb_store", "animated": true },
    { "id": "e6", "source": "dynamic_kb_kisti_articles", "target": "dynamic_kb_merge", "animated": true },
    { "id": "e7", "source": "dynamic_kb_kisti_patents", "target": "dynamic_kb_merge", "animated": true },
    { "id": "e8", "source": "dynamic_kb_existing_cnt", "target": "dynamic_kb_merge", "animated": true },
    { "id": "e9", "source": "dynamic_kb_merge", "target": "dynamic_kb_store", "animated": true },
    { "id": "e10", "source": "static_kb_store", "target": "kb_query", "animated": true },
    { "id": "e11", "source": "dynamic_kb_store", "target": "kb_query", "animated": true },
    { "id": "e12", "source": "cnt_folder_input", "target": "cnt_doc_aggregator", "animated": true },
    { "id": "e13", "source": "cnt_folder_input", "target": "booklet_page1_parser", "animated": true },
    { "id": "e14", "source": "cnt_doc_aggregator", "target": "proposal_parser", "animated": true },
    { "id": "e15", "source": "booklet_page1_parser", "target": "domain_classifier", "animated": true },
    { "id": "e16", "source": "domain_classifier", "target": "match_ratio_assigner", "animated": true },
    { "id": "e17", "source": "proposal_parser", "target": "match_ratio_assigner", "animated": true },
    { "id": "e18", "source": "match_ratio_assigner", "target": "evaluator_1", "animated": true },
    { "id": "e19", "source": "match_ratio_assigner", "target": "evaluator_2", "animated": true },
    { "id": "e20", "source": "match_ratio_assigner", "target": "evaluator_3", "animated": true },
    { "id": "e21", "source": "match_ratio_assigner", "target": "evaluator_4", "animated": true },
    { "id": "e22", "source": "match_ratio_assigner", "target": "evaluator_5", "animated": true },
    { "id": "e23", "source": "match_ratio_assigner", "target": "evaluator_6", "animated": true },
    { "id": "e24", "source": "match_ratio_assigner", "target": "evaluator_7", "animated": true },
    { "id": "e25", "source": "match_ratio_assigner", "target": "evaluator_8", "animated": true },
    { "id": "e26", "source": "match_ratio_assigner", "target": "evaluator_9", "animated": true },
    { "id": "e27", "source": "match_ratio_assigner", "target": "evaluator_10", "animated": true },
    { "id": "e28", "source": "kb_query", "target": "evaluator_1", "animated": true },
    { "id": "e29", "source": "kb_query", "target": "evaluator_2", "animated": true },
    { "id": "e30", "source": "kb_query", "target": "evaluator_3", "animated": true },
    { "id": "e31", "source": "kb_query", "target": "evaluator_4", "animated": true },
    { "id": "e32", "source": "kb_query", "target": "evaluator_5", "animated": true },
    { "id": "e33", "source": "kb_query", "target": "evaluator_6", "animated": true },
    { "id": "e34", "source": "kb_query", "target": "evaluator_7", "animated": true },
    { "id": "e35", "source": "kb_query", "target": "evaluator_8", "animated": true },
    { "id": "e36", "source": "kb_query", "target": "evaluator_9", "animated": true },
    { "id": "e37", "source": "kb_query", "target": "evaluator_10", "animated": true },
    { "id": "e38", "source": "evaluator_1", "target": "citation_extractor", "animated": true },
    { "id": "e39", "source": "evaluator_2", "target": "citation_extractor", "animated": true },
    { "id": "e40", "source": "evaluator_3", "target": "citation_extractor", "animated": true },
    { "id": "e41", "source": "evaluator_4", "target": "citation_extractor", "animated": true },
    { "id": "e42", "source": "evaluator_5", "target": "citation_extractor", "animated": true },
    { "id": "e43", "source": "evaluator_6", "target": "citation_extractor", "animated": true },
    { "id": "e44", "source": "evaluator_7", "target": "citation_extractor", "animated": true },
    { "id": "e45", "source": "evaluator_8", "target": "citation_extractor", "animated": true },
    { "id": "e46", "source": "evaluator_9", "target": "citation_extractor", "animated": true },
    { "id": "e47", "source": "evaluator_10", "target": "citation_extractor", "animated": true },
    { "id": "e48", "source": "citation_extractor", "target": "eval_merge", "animated": true },
    { "id": "e49", "source": "evaluator_1", "target": "eval_merge", "animated": true },
    { "id": "e50", "source": "evaluator_2", "target": "eval_merge", "animated": true },
    { "id": "e51", "source": "evaluator_3", "target": "eval_merge", "animated": true },
    { "id": "e52", "source": "evaluator_4", "target": "eval_merge", "animated": true },
    { "id": "e53", "source": "evaluator_5", "target": "eval_merge", "animated": true },
    { "id": "e54", "source": "evaluator_6", "target": "eval_merge", "animated": true },
    { "id": "e55", "source": "evaluator_7", "target": "eval_merge", "animated": true },
    { "id": "e56", "source": "evaluator_8", "target": "eval_merge", "animated": true },
    { "id": "e57", "source": "evaluator_9", "target": "eval_merge", "animated": true },
    { "id": "e58", "source": "evaluator_10", "target": "eval_merge", "animated": true },
    { "id": "e59", "source": "eval_merge", "target": "voting_aggregator", "animated": true },
    { "id": "e60", "source": "eval_merge", "target": "repeat_controller", "animated": true },
    { "id": "e61", "source": "repeat_controller", "target": "statistical_analyzer", "animated": true },
    { "id": "e62", "source": "voting_aggregator", "target": "accuracy_validator", "animated": true },
    { "id": "e63", "source": "statistical_analyzer", "target": "accuracy_validator", "animated": true },
    { "id": "e64", "source": "statistical_analyzer", "target": "consistency_checker", "animated": true },
    { "id": "e65", "source": "statistical_analyzer", "target": "pattern_analyzer", "animated": true },
    { "id": "e66", "source": "ground_truth", "target": "accuracy_validator", "animated": true },
    { "id": "e67", "source": "accuracy_validator", "target": "validation_merge", "animated": true },
    { "id": "e68", "source": "consistency_checker", "target": "validation_merge", "animated": true },
    { "id": "e69", "source": "pattern_analyzer", "target": "validation_merge", "animated": true },
    { "id": "e70", "source": "validation_merge", "target": "viz_dashboard", "animated": true },
    { "id": "e71", "source": "validation_merge", "target": "result_json", "animated": true },
    { "id": "e72", "source": "validation_merge", "target": "result_excel", "animated": true },
    { "id": "e73", "source": "validation_merge", "target": "result_pdf", "animated": true },
    { "id": "e74", "source": "voting_aggregator", "target": "vote_chart", "animated": true },
    { "id": "e75", "source": "voting_aggregator", "target": "citation_view", "animated": true }
  ],
  "metadata": {
    "author": "Handbox",
    "framework_version": "2.0",
    "description": "매칭 비율 기반 동적 프로파일 + Citation 추적 시스템. 에이전트에게 고정된 전문 분야를 배정하지 않고, 매칭 비율(실험 변수)에 따라 신청서 분야와의 매칭 레벨을 동적으로 배정합니다.",
    "key_changes_from_v1": [
      "expertise/stance/persona 속성 완전 제거",
      "매칭 비율(exact:partial:no_match) 기반 동적 프로파일 생성",
      "temperature 0.5 통일",
      "다수결 기준 6/10 → 7/10 (≥2/3) 변경",
      "개별 판정 규칙: 각 위원이 신규성≥35 AND 진보성≥35로 독립 판정",
      "Citation 3유형 (신청서/선행기술/매뉴얼) 근거 추적 및 검증",
      "반복 실행 제어(repeat_controller) 추가로 V2 일관성 검증",
      "통계 분석(statistical_analyzer) 추가: ANOVA, ICC, Fleiss' Kappa",
      "8종 시각화 대시보드(viz_dashboard) 추가"
    ],
    "experiment_conditions": {
      "C0_control": { "ratio": "10:0:0", "description": "전원 exact_match (baseline)" },
      "C1_default": { "ratio": "2:4:4", "description": "기본 설정" },
      "C2_more_exact": { "ratio": "4:4:2", "description": "exact 비율 증가" },
      "C3_more_nomatch": { "ratio": "2:2:6", "description": "no_match 비율 증가" },
      "C4_extreme": { "ratio": "0:0:10", "description": "전원 no_match (하한 측정)" }
    },
    "research_questions": [
      "RQ1: 매칭 비율이 통과 판정률(V1)에 유의미한 영향을 미치는가?",
      "RQ2: 매칭 비율이 반복 일관성(V2)에 유의미한 영향을 미치는가?",
      "RQ3: exact_match 에이전트가 no_match 에이전트보다 체계적으로 높은/낮은 점수를 부여하는가?",
      "RQ4: 매칭도에 따라 Citation 활용 패턴이 달라지는가?",
      "RQ5: 최적의 매칭 비율은 무엇인가? (V1과 V2를 동시에 최대화)"
    ]
  },
  "created_at": "2026-02-03T00:00:00.000Z",
  "updated_at": "2026-02-03T00:00:00.000Z"
}
